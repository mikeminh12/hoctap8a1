<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Diá»…n Ä‘Ã n há»c táº­p</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="navbar"></div>

  <script type="module">
    // ğŸ”¥ Load nav.html trÆ°á»›c, rá»“i má»›i load nav.js
    fetch("nav.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("navbar").innerHTML = html;
        import('./nav.js');
      });
  </script>

  <div class="container fade-in">
    <h1>ğŸ“š Diá»…n Ä‘Ã n há»c táº­p</h1>
    <p style="margin-bottom: 20px;">Chia sáº» kiáº¿n thá»©c, tháº£o luáº­n bÃ i táº­p, há»i Ä‘Ã¡p há»c táº­p táº¡i Ä‘Ã¢y!</p>

    <button id="postBtn">ğŸ“ ÄÄƒng bÃ i</button>
    <hr> <div id="posts">â³ Äang táº£i bÃ i viáº¿t...</div>
  </div>

  <script type="module">
    import { auth, db } from './firebase.js';
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { collection, getDocs, orderBy, query } 
      from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    // ğŸŸ¢ Hiá»‡n nÃºt ÄÄƒng bÃ i náº¿u user Ä‘Ã£ Ä‘Äƒng nháº­p
    onAuthStateChanged(auth, user => {
      if (user) {
        const btn = document.getElementById("postBtn");
        btn.style.display = "inline-block";
        btn.onclick = () => location.href = "post.html";
      }
    });

    // ğŸ“° Load bÃ i viáº¿t
    try {
      const postCol = collection(db, "posts");
      const q = query(postCol, orderBy("createdAt", "desc"));
      const snap = await getDocs(q);
      const container = document.getElementById("posts");

      if (snap.empty) {
        container.innerHTML = "<p>ğŸ˜¶ ChÆ°a cÃ³ bÃ i viáº¿t nÃ o, hÃ£y lÃ  ngÆ°á»i Ä‘áº§u tiÃªn Ä‘Äƒng nhÃ©!</p>";
      } else {
        container.innerHTML = "";
        snap.forEach(docSnap => {
          const d = docSnap.data();
          container.innerHTML += `
            <div class="card">
              <h3>${d.title}</h3>
              <small>âœï¸ TÃ¡c giáº£: <b>${d.username || "áº¨n danh"}</b></small><br>
              <button class="btn-card" onclick="window.location.href='post-detail.html?id=${docSnap.id}'">
                Xem chi tiáº¿t
              </button>
            </div>
          `;
        });
      }

    } catch(err) {
      document.getElementById("posts").innerHTML = "<p>âŒ Lá»—i khi táº£i dá»¯ liá»‡u: " + err.message + "</p>";
    }
  </script>
</body>
</html>