<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Diá»…n Ä‘Ã n há»c táº­p</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin: 16px 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }
    .card:hover { transform: translateY(-4px); }
    .card h3 { margin-bottom: 6px; color: #007bff; }
    .card small { color: #555; font-size: 0.9em; }
    .card button {
      margin-top: 10px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .card button:hover { background: #0056b3; }

    /* NÃºt Ä‘Äƒng bÃ i */
    #postBtn {
      display: none;
      background: #28a745;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-bottom: 20px;
      transition: background 0.2s;
    }
    #postBtn:hover { background: #1e7e34; }
  </style>
</head>
<body>
  <!-- NAVBAR IMPORT -->
  <div id="navbar"></div>

  <script type="module">
    // ğŸ”¥ Load nav.html trÆ°á»›c, rá»“i má»›i load nav.js
    fetch("nav.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("navbar").innerHTML = html;
        import('./nav.js');
      });
  </script>

  <div class="container fade-in">
    <h1>ğŸ“š Diá»…n Ä‘Ã n há»c táº­p</h1>
    <p>Chia sáº» kiáº¿n thá»©c, tháº£o luáº­n bÃ i táº­p, há»i Ä‘Ã¡p há»c táº­p táº¡i Ä‘Ã¢y!</p>

    <!-- ğŸ”¥ NÃºt Ä‘Äƒng bÃ i -->
    <button id="postBtn">ğŸ“ ÄÄƒng bÃ i</button>

    <hr style="margin: 20px 0;">
    <div id="posts">â³ Äang táº£i bÃ i viáº¿t...</div>
  </div>

  <script type="module">
    import { auth, db } from './firebase.js';
    import { onAuthStateChanged } 
      from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { collection, getDocs, orderBy, query } 
      from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    // ğŸŸ¢ Hiá»‡n nÃºt ÄÄƒng bÃ i náº¿u user Ä‘Ã£ Ä‘Äƒng nháº­p
    onAuthStateChanged(auth, user => {
      if (user) {
        const btn = document.getElementById("postBtn");
        btn.style.display = "inline-block";
        btn.onclick = () => location.href = "post.html";
      }
    });

    // ğŸ“° Load bÃ i viáº¿t
    try {
      const postCol = collection(db, "posts");
      const q = query(postCol, orderBy("createdAt", "desc"));
      const snap = await getDocs(q);
      const container = document.getElementById("posts");

      if (snap.empty) {
        container.innerHTML = "<p>ğŸ˜¶ ChÆ°a cÃ³ bÃ i viáº¿t nÃ o, hÃ£y lÃ  ngÆ°á»i Ä‘áº§u tiÃªn Ä‘Äƒng nhÃ©!</p>";
      } else {
        container.innerHTML = "";
        snap.forEach(docSnap => {
          const d = docSnap.data();
          container.innerHTML += `
            <div class="card">
              <h3>${d.title}</h3>
              <small>âœï¸ TÃ¡c giáº£: <b>${d.username || "áº¨n danh"}</b></small><br>
              <button onclick="window.location.href='post-detail.html?id=${docSnap.id}'">
                Xem chi tiáº¿t
              </button>
            </div>
          `;
        });
      }
    } catch (err) {
      console.error(err);
      document.getElementById("posts").innerHTML = 
        "<p style='color:red'>âš ï¸ KhÃ´ng táº£i Ä‘Æ°á»£c bÃ i viáº¿t. Kiá»ƒm tra Firestore rules nhÃ©!</p>";
    }
  </script>
</body>
</html>
