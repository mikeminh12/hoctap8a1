<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Chi tiết tin tức</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="navbar"></div>

  <script type="module">
    // 🔥 Load nav.html trước, rồi mới load nav.js
    fetch("nav.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("navbar").innerHTML = html;
        import('./nav.js');
      });
  </script>

  <div class="container-detail fade-in">
    <a href="news.html" class="back-btn">⬅️ Quay lại tin tức</a>
    <h1 id="newsTitle">Đang tải...</h1>
    <p class="meta" id="newsMeta"></p>
    <img id="newsImage" class="news-img" style="display:none;">
    <p id="newsBody"></p>
  </div>

  <script type="module">
    import { db } from './firebase.js';
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    // 🔥 Bọc logic vào hàm IIFE để có thể dùng 'return'
    (async function loadNewsDetail() {
        // 🔎 Lấy ID tin từ URL
        const params = new URLSearchParams(window.location.search);
        const newsId = params.get("id");

        const titleEl = document.getElementById("newsTitle");
        const metaEl = document.getElementById("newsMeta");
        const bodyEl = document.getElementById("newsBody");
        const imgEl = document.getElementById("newsImage");

        // 🔥 Load chi tiết tin tức
        const ref = doc(db, "news", newsId);
        const snap = await getDoc(ref);
        
        if (!snap.exists()) {
            titleEl.textContent = "Tin tức không tồn tại 😢";
            return; // ✅ Return hợp lệ trong hàm async
        }

        const data = snap.data();
        titleEl.textContent = data.title;
        bodyEl.textContent = data.body;
        metaEl.textContent = "🗓️ " + (data.createdAt?.toDate?.().toLocaleString() || "N/A");

        if (data.imageUrl) {
            imgEl.src = data.imageUrl;
            imgEl.style.display = "block";
        }
    })();
  </script>
</body>
</html>