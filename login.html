<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ÄÄƒng nháº­p</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- NAVBAR IMPORT -->

<div id="navbar"></div>

<script>
  fetch("nav.html")
    .then(res => res.text())
    .then(html => document.getElementById("navbar").innerHTML = html);
</script>

<!-- Import nav logic -->
<script type="module" src="nav.js"></script>
<div class="container">
  <!-- Ná»™i dung trang á»Ÿ Ä‘Ã¢y -->
   <h2>ğŸ” ÄÄƒng nháº­p / ÄÄƒng kÃ½</h2>
</div>

  

  <input id="username" placeholder="TÃªn tÃ i khoáº£n">
  <input id="password" type="password" placeholder="Máº­t kháº©u">
  <button id="login">ÄÄƒng nháº­p</button>
  <button id="signup">ÄÄƒng kÃ½</button>

  <script type="module">
  import { auth, db } from './firebase.js';
  import { createUserWithEmailAndPassword, signInWithEmailAndPassword } 
    from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
  import { doc, setDoc } 
    from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

  const fakeMail = (u) => u + "@study.local";

  // ğŸ”¹ NÃºt Ä‘Äƒng kÃ½
  document.getElementById("signup").onclick = async () => {
    const u = username.value, p = password.value;
    const userCred = await createUserWithEmailAndPassword(auth, fakeMail(u), p);
    await setDoc(doc(db, "users", userCred.user.uid), {
      username: u, role: "student"
    });

    // â• Sau khi Ä‘Äƒng kÃ½ xong, lÆ°u user vÃ´ localStorage
    localStorage.setItem("user", JSON.stringify({ username: u }));

    alert("ÄÄƒng kÃ½ thÃ nh cÃ´ng!");
    location.href = "index.html";
  };

  // ğŸ”¹ NÃºt Ä‘Äƒng nháº­p
  document.getElementById("login").onclick = async () => {
    const u = username.value, p = password.value;
    await signInWithEmailAndPassword(auth, fakeMail(u), p);

    // ğŸ’¾ ThÃªm dÃ²ng nÃ y Ä‘á»ƒ lÆ°u user khi Ä‘Äƒng nháº­p
    localStorage.setItem("user", JSON.stringify({ username: u }));

    // âœ Chuyá»ƒn vá» trang chá»§
    location.href = "index.html";
  };
</script>

</body>
</html>
